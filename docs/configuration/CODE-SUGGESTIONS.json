[
  {
    "line": 1,
    "suggestion": "Add proper error handling and consolidate the complex event log injection logic into a separate async function with try-catch blocks.",
    "filePath": "C:\\Users\\jwpmi\\Downloads\\AI\\wb\\components\\wb-base\\wb-base.js",
    "component": "wb-base",
    "category": "Error Handling & Code Quality",
    "severity": "HIGH",
    "details": {
      "before": "function injectEventLogTabIfEnabled() {\n    if (_eventLogTabInjected) return;\n    try {\n        const response = await fetch('/config/components.config.json');\n        if (!response.ok) return;\n        const config = await response.json();\n        // ... 15+ lines of complex logic\n    } catch (e) {}\n}",
      "after": "async function injectEventLogTabIfEnabled() {\n    if (_eventLogTabInjected) return;\n    _eventLogTabInjected = true;\n    try {\n        const config = await loadComponentConfig();\n        if (!config?.eventLogging) return;\n        await customElements.whenDefined('wb-demo');\n        injectEventLogTab();\n    } catch (e) {\n        console.debug('Event log injection skipped', e.message);\n    }\n}\n\nasync function loadComponentConfig() {\n    const response = await fetch('/config/components.config.json');\n    return response.ok ? response.json() : null;\n}\n\nfunction injectEventLogTab() {\n    document.querySelectorAll('wb-demo:not([slot=\"event-log\"] > *)').forEach(demo => {\n        const logTab = document.createElement('div');\n        logTab.setAttribute('slot', 'event-log');\n        logTab.innerHTML = '<wb-event-log style=\"width:100%;height:300px;display:block;\"></wb-event-log>';\n        demo.appendChild(logTab);\n    });\n}",
      "impact": "Reduces complexity, improves readability, adds proper error handling",
      "estimatedTime": "15 minutes"
    }
  },
  {
    "line": 40,
    "suggestion": "Consolidate duplicate export patterns - choose either ES6 modules OR global namespace, not both. Recommend ES6 only.",
    "filePath": "C:\\Users\\jwpmi\\Downloads\\AI\\wb\\components\\wb-base\\wb-base.js",
    "component": "wb-base",
    "category": "Code Organization",
    "severity": "MEDIUM",
    "details": {
      "before": "// Expose globally (backward compatibility)\nif (typeof window !== 'undefined') {\n    window['WBBaseComponent'] = WBBaseComponent;\n    if (!window['WB']) window['WB'] = { components: {}, utils: {} };\n    window['WB'].components.WBBaseComponent = WBBaseComponent;\n}\n\n// ES6 Module Exports\nexport { WBBaseComponent, WBDemoBase };\nexport default WBBaseComponent;",
      "after": "// Recommended: ES6 only\nexport { WBBaseComponent, WBDemoBase };\nexport default WBBaseComponent;\n\n// Optional backward compatibility in a separate file if needed:\n// globalNamespace.js would handle: window.WB, window.WBBaseComponent, etc.",
      "impact": "Cleaner module system, easier to tree-shake, better for bundlers",
      "estimatedTime": "10 minutes"
    }
  },
  {
    "line": 80,
    "suggestion": "Extract the static logEvent/getEventLog methods into WBEventLog class for better encapsulation and reusability.",
    "filePath": "C:\\Users\\jwpmi\\Downloads\\AI\\wb\\components\\wb-base\\wb-base.js",
    "component": "wb-base",
    "category": "Refactoring & Design Patterns",
    "severity": "MEDIUM",
    "details": {
      "before": "static logEvent(message, type = 'info') {\n    WBEventLogState.entries.unshift({ type, message, time: new Date().toLocaleTimeString() });\n    if (WBEventLogState.entries.length > 50) {\n        WBEventLogState.entries.length = 50;\n    }\n    WBEventLogState.entries = WBEventLogState.entries;\n}\n\nstatic getEventLog() {\n    return WBEventLogState.entries;\n}",
      "after": "class WBEventLog {\n    static #MAX_ENTRIES = 50;\n    static #entries = [];\n    \n    static add(message, type = 'info') {\n        this.#entries.unshift({ type, message, time: new Date().toLocaleTimeString() });\n        if (this.#entries.length > this.#MAX_ENTRIES) {\n            this.#entries.length = this.#MAX_ENTRIES;\n        }\n        return this.#entries[0];\n    }\n    \n    static getAll() {\n        return [...this.#entries]; // Return copy, not reference\n    }\n    \n    static clear() {\n        this.#entries.length = 0;\n    }\n}\n\n// In WBBaseComponent:\nstatic logEvent(message, type = 'info') {\n    return WBEventLog.add(message, type);\n}\n\nstatic getEventLog() {\n    return WBEventLog.getAll();\n}",
      "impact": "Better encapsulation, prevents external modification of entries array, cleaner API",
      "estimatedTime": "30 minutes"
    }
  },
  {
    "line": 1,
    "suggestion": "Create and import registerWBComponent helper to replace 45+ lines of duplicate registration code found in every component.",
    "filePath": "C:\\Users\\jwpmi\\Downloads\\AI\\wb\\components\\wb-button\\wb-button.js",
    "component": "wb-button",
    "category": "Code Deduplication",
    "severity": "HIGH",
    "details": {
      "before": "if (customElements && !customElements.get('wb-button')) {\n  customElements.define('wb-button', WBButton);\n  console.log('ðŸ”˜ WB Button Web Component: Custom element registered');\n} else if (customElements.get('wb-button')) {\n  console.log('ðŸ”˜ WB Button Web Component: Already registered');\n} else {\n  console.error('ðŸ”˜ WB Button Web Component: Custom Elements not supported');\n}\n\nif (window.WBComponentRegistry && typeof window.WBComponentRegistry.register === 'function') {\n    window.WBComponentRegistry.register('wb-button', WBButton, ['wb-event-log'], {\n        version: '1.0.0',\n        type: 'form',\n        role: 'ui-element',\n        description: 'Versatile button component...',\n        api: { /* 10+ lines */ }\n    });\n}\n\nif (!window.WB) window.WB = { components: {}, utils: {} };\nwindow.WB.components.WBButton = WBButton;\nwindow.WBButton = WBButton;\n\nexport { WBButton };\nexport default WBButton;",
      "after": "import { registerWBComponent, getComponentMetadata } from '../component-utils/registration-helper.js';\n\n// Single registration call - replaces 40+ lines:\nregisterWBComponent('wb-button', WBButton, getComponentMetadata(\n    'WBButton',\n    'ui',\n    'Versatile button component with multiple styles, sizes, and interaction states',\n    {\n        events: ['click', 'toggle'],\n        attributes: ['variant', 'size', 'disabled', 'active'],\n        methods: ['render', 'setVariant', 'setSize']\n    }\n));\n\nexport { WBButton };\nexport default WBButton;",
      "impact": "Removes 40+ duplicate lines per component Ã— 50 components = 2000+ lines saved",
      "estimatedTime": "5 minutes per component"
    }
  },
  {
    "line": 1,
    "suggestion": "Move duplicate createSignal utility to component-utils.js to avoid duplication across all components using reactive state.",
    "filePath": "C:\\Users\\jwpmi\\Downloads\\AI\\wb\\components\\wb-button\\wb-button.js",
    "component": "wb-button & all reactive components",
    "category": "Code Deduplication",
    "severity": "MEDIUM",
    "details": {
      "before": "// Found in: wb-button.js, wb-card.js, wb-nav.js, wb-tab.js, etc.\nfunction createSignal(initial) {\n  let value = initial;\n  const listeners = [];\n  function get() { return value; }\n  function set(v) { value = v; listeners.forEach(fn => fn(value)); }\n  function subscribe(fn) { listeners.push(fn); }\n  return [get, set, subscribe];\n}",
      "after": "// In component-utils.js:\nexport function createSignal(initial) {\n  let value = initial;\n  const listeners = new Set();\n  return [\n    () => value,                      // get\n    (v) => {\n      if (value !== v) {\n        value = v;\n        listeners.forEach(fn => fn(value));\n      }\n    },                                 // set\n    (fn) => listeners.add(fn)          // subscribe\n  ];\n}\n\n// In each component:\nimport { createSignal } from '../component-utils/component-utils.js';\n\n// Then use normally:\n[this.getActive, this.setActive, this.onActive] = createSignal(false);",
      "impact": "Eliminates signal function duplication across 15+ components",
      "estimatedTime": "20 minutes total"
    }
  },
  {
    "line": 100,
    "suggestion": "Add comprehensive error handling to all async operations, especially render() method which modifies innerHTML without validation.",
    "filePath": "C:\\Users\\jwpmi\\Downloads\\AI\\wb\\components\\wb-button\\wb-button.js",
    "component": "wb-button",
    "category": "Error Handling & Security",
    "severity": "MEDIUM",
    "details": {
      "before": "render() {\n    const variant = this.getVariant();\n    const size = this.getSize();\n    const active = this.getActive();\n    const disabled = this.getDisabled();\n    const image = this.getImage();\n    const status = this.getStatus();\n    const bgImage = this.getBgImage();\n    this.innerHTML = `\n      <button\n        class=\"...\"\n        onclick=\"this.getRootNode().host.handleClick(event)\"\n        type=\"button\"\n      >\n        // Template code\n      </button>\n    `; // No validation!\n    if (bgImage) {\n        this.style.setProperty('--wb-btn-bg-image', `url(${bgImage})`);\n    }\n}",
      "after": "render() {\n    try {\n        const variant = this.getVariant();\n        const size = this.getSize();\n        const active = this.getActive();\n        const disabled = this.getDisabled();\n        const image = this.getImage();\n        const status = this.getStatus();\n        const bgImage = this.getBgImage();\n        \n        // Validate inputs\n        if (!this._validateVariant(variant)) {\n            this.logError('Invalid variant', { variant });\n            return;\n        }\n        \n        // Build template safely\n        const template = this._buildButtonTemplate({\n            variant, size, active, disabled, image, status, bgImage\n        });\n        \n        // Set innerHTML safely\n        this.innerHTML = template;\n        \n        // Set CSS variables safely\n        if (bgImage && this._isValidUrl(bgImage)) {\n            this.style.setProperty('--wb-btn-bg-image', `url(${bgImage})`);\n        } else if (bgImage) {\n            this.logError('Invalid background image URL', { bgImage });\n        }\n        \n    } catch (error) {\n        this.reportError(error, { action: 'render' });\n        // Fallback render\n        this.innerHTML = '<button>Error rendering button</button>';\n    }\n}\n\n_validateVariant(variant) {\n    return Object.keys(this.config.classes.variants).includes(variant);\n}\n\n_isValidUrl(url) {\n    try {\n        new URL(url, window.location.origin);\n        return true;\n    } catch {\n        return false;\n    }\n}\n\n_buildButtonTemplate({ variant, size, active, disabled, image, status, bgImage }) {\n    const classes = [\n        this.config.classes.base,\n        this.config.classes.variants[variant],\n        this.config.classes.sizes[size],\n        active ? this.config.classes.states.active : '',\n        disabled ? this.config.classes.states.disabled : ''\n    ].filter(Boolean).join(' ');\n    \n    return `\n      <button\n        class=\"${classes}\"\n        onclick=\"this.getRootNode().host.handleClick(event)\"\n        type=\"button\"\n        ${disabled ? 'disabled' : ''}\n      >\n        ${image ? `<img class='${this.config.classes.elements.image}' src='${this._escapeHtml(image)}' alt='' />` : ''}\n        <slot></slot>\n        ${status ? `<span class='${this.config.classes.elements.status} ${this.config.classes.elements.status}--${status}'></span>` : ''}\n        ${variant === 'toggle' ? `<span class='${this.config.classes.elements.checkmark}'>âœ“</span>` : ''}\n      </button>\n    `;\n}\n\n_escapeHtml(str) {\n    const div = document.createElement('div');\n    div.textContent = str;\n    return div.innerHTML;\n}",
      "impact": "Prevents XSS vulnerabilities, handles invalid data gracefully, better debugging",
      "estimatedTime": "45 minutes"
    }
  },
  {
    "line": 1,
    "suggestion": "Remove duplicate console.log statements and use WBBaseComponent.logInfo() for consistency with framework logging.",
    "filePath": "C:\\Users\\jwpmi\\Downloads\\AI\\wb\\components\\wb-button\\wb-button.js",
    "component": "wb-button",
    "category": "Code Quality & Logging",
    "severity": "MEDIUM",
    "details": {
      "before": "console.log('ðŸ”˜ WB Button Web Component: Starting initialization...');\n// ... code ...\nif (customElements && !customElements.get('wb-button')) {\n  customElements.define('wb-button', WBButton);\n  console.log('ðŸ”˜ WB Button Web Component: Custom element registered');\n} else if (customElements.get('wb-button')) {\n  console.log('ðŸ”˜ WB Button Web Component: Already registered');\n} else {\n  console.error('ðŸ”˜ WB Button Web Component: Custom Elements not supported');\n}",
      "after": "// In constructor:\nthis.logDebug('WBButton constructor called');\n\n// In connectedCallback:\nconnectedCallback() {\n    super.connectedCallback();\n    this.logInfo('WBButton connected');\n    loadComponentCSS(this, 'wb-button.css');\n    this.render();\n}\n\n// Replace registration console.log with logInfo via registerWBComponent\n// registerWBComponent already handles logging",
      "impact": "Consistent logging across all components, centralized control",
      "estimatedTime": "10 minutes per component"
    }
  },
  {
    "line": 1,
    "suggestion": "Consolidate duplicate demo files: keep only wb-card-demo.html, archive card-demo-old.html if it exists.",
    "filePath": "C:\\Users\\jwpmi\\Downloads\\AI\\wb\\components\\wb-card\\",
    "component": "wb-card",
    "category": "File Organization",
    "severity": "LOW",
    "details": {
      "action": "File cleanup",
      "files": {
        "keep": "wb-card-demo.html (most recent/complete)",
        "archive": "wb-card-demo-old.html (if exists), card-demo.html (if duplicate)"
      },
      "impact": "Reduces confusion, easier maintenance",
      "estimatedTime": "5 minutes per component"
    }
  },
  {
    "line": 1,
    "suggestion": "Fix component inheritance: wb-card should extend WBBaseComponent, not HTMLElement, to inherit logging and event methods.",
    "filePath": "C:\\Users\\jwpmi\\Downloads\\AI\\wb\\components\\wb-card\\wb-card.js",
    "component": "wb-card",
    "category": "Architecture & Best Practices",
    "severity": "HIGH",
    "details": {
      "before": "class WBCard extends HTMLElement {\n    constructor() {\n        super();\n        // Missing: logInfo, logError, fireEvent, getAttr methods\n    }\n}",
      "after": "import { WBBaseComponent } from '../wb-base/wb-base.js';\nimport { loadComponentCSS } from '../wb-css-loader/wb-css-loader.js';\nimport { registerWBComponent, getComponentMetadata } from '../component-utils/registration-helper.js';\n\nclass WBCard extends WBBaseComponent {\n    constructor() {\n        super();\n        // Now inherits: logInfo(), fireEvent(), getAttr(), reportError(), etc.\n    }\n    \n    connectedCallback() {\n        super.connectedCallback(); // Important!\n        loadComponentCSS(this, 'wb-card.css');\n        this.render();\n        this.logInfo('WBCard connected', { title: this.getTitle() });\n    }\n}",
      "impact": "Consistent with framework patterns, access to logging/theming/events",
      "estimatedTime": "20 minutes"
    }
  },
  {
    "line": 200,
    "suggestion": "Standardize event naming: change 'wbCardReady' to 'wb:card:ready' to match framework convention.",
    "filePath": "C:\\Users\\jwpmi\\Downloads\\AI\\wb\\components\\wb-card\\wb-card.js",
    "component": "wb-card & all components",
    "category": "Standardization & Consistency",
    "severity": "MEDIUM",
    "details": {
      "before": "this.dispatchEvent(new CustomEvent('wbCardReady', { \n    bubbles: true,\n    detail: { component: this, config: this.config }\n}));",
      "after": "// Use inherited fireEvent method from WBBaseComponent:\nthis.fireEvent('wb:card:ready', {\n    component: this,\n    config: this.config\n});",
      "impact": "Consistency across all components, easier to track events",
      "estimatedTime": "10 minutes per component"
    }
  },
  {
    "line": 1,
    "suggestion": "Add missing error handling to all fetch operations in wb-nav.js, especially config loading.",
    "filePath": "C:\\Users\\jwpmi\\Downloads\\AI\\wb\\components\\wb-nav\\wb-nav.js",
    "component": "wb-nav",
    "category": "Error Handling",
    "severity": "HIGH",
    "details": {
      "before": "async loadConfig() {\n    try {\n        let configPath = './wb-nav.schema.json';\n        if (window.WBComponentUtils && typeof window.WBComponentUtils.getPath === 'function') {\n            try {\n                const basePath = window.WBComponentUtils.getPath('wb-nav.js', '../components/wb-nav/');\n                configPath = basePath + 'wb-nav.schema.json';\n            } catch (e) {\n                console.warn('ðŸ§­ WB Nav: Could not use WBComponentUtils for schema path');\n            }\n        }\n        \n        const response = await fetch(configPath);\n        if (!response.ok) throw new Error(`HTTP ${response.status}`);\n        this.config = await response.json();\n        console.log('ðŸ§­ WB Nav: Configuration loaded', this.config);\n    } catch (error) {\n        console.warn('ðŸ§­ WB Nav: Could not load wb-nav.schema.json, using defaults', error);\n        this.config = this.getDefaultConfig();\n    }\n}",
      "after": "async loadConfig() {\n    try {\n        const configPath = this._getConfigPath();\n        const response = await fetch(configPath);\n        \n        if (!response.ok) {\n            throw new Error(`Failed to load config: HTTP ${response.status}`);\n        }\n        \n        this.config = await response.json();\n        this.logInfo('Navigation configuration loaded', { path: configPath });\n        \n    } catch (error) {\n        this.logError('Failed to load navigation config', { \n            error: error.message,\n            action: 'loadConfig'\n        });\n        this.config = this.getDefaultConfig();\n    }\n}\n\n_getConfigPath() {\n    if (!window.WBComponentUtils?.getPath) {\n        return './wb-nav.schema.json';\n    }\n    \n    try {\n        const basePath = window.WBComponentUtils.getPath('wb-nav.js', '../components/wb-nav/');\n        return basePath + 'wb-nav.schema.json';\n    } catch (e) {\n        this.logDebug('WBComponentUtils path resolution failed, using default', { error: e.message });\n        return './wb-nav.schema.json';\n    }\n}",
      "impact": "Better error handling, consistent logging, cleaner code",
      "estimatedTime": "30 minutes"
    }
  },
  {
    "line": 300,
    "suggestion": "Simplify complex parseChildrenItems() function - add early returns and extract helper methods for better readability.",
    "filePath": "C:\\Users\\jwpmi\\Downloads\\AI\\wb\\components\\wb-nav\\wb-nav.js",
    "component": "wb-nav",
    "category": "Code Quality & Readability",
    "severity": "MEDIUM",
    "details": {
      "before": "// 40+ lines of nested loops and conditions in single method",
      "after": "parseChildrenItems() {\n    const items = this._parseWebListItems() || this._parseLegacyListItems();\n    if (items.length > 0) {\n        this.items = items;\n    }\n}\n\n_parseWebListItems() {\n    const listItems = Array.from(this.querySelectorAll('wb-list-item'));\n    if (listItems.length === 0) return null;\n    \n    return listItems.map((el, idx) => ({\n        id: el.getAttribute('data-id') || el.getAttribute('id') || `item-${idx}`,\n        text: (el.textContent || '').trim(),\n        href: el.getAttribute('href') || el.getAttribute('data-href') || '#',\n        active: el.hasAttribute('active'),\n        disabled: el.hasAttribute('disabled')\n    }));\n}\n\n_parseLegacyListItems() {\n    const lists = Array.from(this.querySelectorAll('ul'));\n    if (lists.length === 0) return null;\n    \n    const items = [];\n    lists.forEach(ul => {\n        const lis = Array.from(ul.querySelectorAll('li'));\n        lis.forEach((li, idx) => {\n            const a = li.querySelector('a');\n            items.push({\n                id: li.getAttribute('data-id') || li.getAttribute('id') || `li-${idx}`,\n                text: a ? (a.textContent || '').trim() : (li.textContent || '').trim(),\n                href: a ? (a.getAttribute('href') || '#') : '#',\n                active: li.classList.contains(this.config.classes.states.active),\n                disabled: li.classList.contains(this.config.classes.states.disabled)\n            });\n        });\n    });\n    \n    return items.length > 0 ? items : null;\n}",
      "impact": "Improved readability, easier to test and maintain",
      "estimatedTime": "45 minutes"
    }
  }
]
