# test-simple-control-panel.md

## Purpose
This document explains the debugging and fixes applied to the test page at [http://127.0.0.1:8083/test-simple-control-panel.html](http://127.0.0.1:8083/test-simple-control-panel.html) and related components in the WB Website Builder project.

## Issues Encountered
1. **Control panel events were not being logged or detected in the test page.**
2. **JavaScript errors in the browser console:**
   - `Identifier 'WBNav' has already been declared`
   - `Failed to execute 'define' on 'CustomElementRegistry': "wb-semanticElements" is not a valid custom element name`
   - `Cannot read properties of undefined (reading 'showControls')` in `wb-viewport.js`

## Fixes Applied

### 1. Control Panel Event Logging
- The test page was updated to listen for all relevant custom events both on `document` and directly on the `wb-control-panel` element.
- A `MutationObserver` was added to ensure listeners are attached even if the control panel is loaded dynamically.
- This ensures all theme, layout, color, and mode change events are captured and displayed in the event log.

### 2. WBNav Duplicate Declaration Error
- The `wb-nav.js` component was being loaded or evaluated multiple times, causing the `WBNav` class to be redeclared.
- **Fix:** The class definition and custom element registration are now wrapped in a guard:
  ```js
  if (typeof WBNav === 'undefined') {
    class WBNav extends HTMLElement { /* ... */ }
    if (!customElements.get('wb-nav')) {
      customElements.define('wb-nav', WBNav);
    }
    window.WBNav = WBNav;
  }
  ```
- This prevents redeclaration and registration errors if the script is loaded more than once.

### 3. Invalid Custom Element Name
- The custom element `wb-semanticElements` was invalid (must be all lowercase and contain a hyphen).
- **Fix:** Renamed to `wb-semantic-elements` everywhere in the codebase.

### 4. wb-viewport.js showControls Error
- Accessing `config.configuration.showControls` could throw if `config` or `config.configuration` was undefined.
- **Fix:** All such accesses are now guarded:
  ```js
  if (config && config.configuration && config.configuration.showControls) {
    // ...
  }
  ```

## Result
- The test page now reliably logs all control panel events.
- All major JavaScript errors related to component registration and configuration are resolved.
- The WB Website Builder environment is now more robust against duplicate script loads and invalid custom element names.

---
*Document generated by GitHub Copilot on 2025-10-13.*
