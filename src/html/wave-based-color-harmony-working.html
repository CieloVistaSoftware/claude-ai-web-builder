<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wave-Based Color Harmony: Interactive Demo</title>
    <style>
        select, select option {
            color: black !important;
        }
        select:focus, select:active, select option:checked, select option:hover {
            color: black !important;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
            color: #e0e0e0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .demo-box {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .audio-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(99, 102, 241, 0.3);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.875rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.25rem;
            font-weight: 600;
            color: #8b5cf6;
        }

        canvas {
            width: 100%;
            height: 300px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border: 1px solid rgba(99, 102, 241, 0.3);
        }

        .color-palette {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        .color-swatch {
            aspect-ratio: 1;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.2s;
        }

        .color-swatch:hover {
            border-color: rgba(255, 255, 255, 0.5);
            transform: scale(1.05);
        }

        h2 {
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 1.5rem;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(99, 102, 241, 0.2);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            cursor: pointer;
            border: none;
        }

        label {
            display: block;
            margin-bottom: 8px;
            margin-top: 15px;
            font-weight: 500;
        }

        .info-box {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #86efac;
        }

        .error-box {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #fca5a5;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåä Wave-Based Color Harmony: Interactive Demo üé®</h1>

        <div class="info-box">
            <strong>üì∫ Audio Tab Selection:</strong> Click "üé§ Audio Tab" button below to select a browser tab with music playing. Then watch the colors react to the music in real-time! üéµ
        </div>

        <div class="demo-box">
            <h2>üé§ Audio Input Controls</h2>
            <div class="audio-controls">
                <button id="startAudioBtn">üé§ Audio Tab</button>
                <button id="stopAudioBtn" disabled>‚èπÔ∏è Stop Audio</button>
                <button id="toggleReactiveBtn">‚ú® Toggle Audio Reactive</button>
            </div>

            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-label">Input Type</div>
                    <div class="stat-value" id="inputType">Idle</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Status</div>
                    <div class="stat-value" id="statusText">Ready</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Sample Rate</div>
                    <div class="stat-value" id="sampleRate">0 Hz</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Buffer Size</div>
                    <div class="stat-value" id="bufferSize">0</div>
                </div>
            </div>

            <h3 style="margin-top: 20px; font-size: 1.1rem;">Frequency Spectrum</h3>
            <canvas id="audioCanvas"></canvas>
        </div>

        <div class="demo-box">
            <h2>üé® Harmony Mode</h2>
            <label for="harmonySelect">Select Color Harmony Algorithm:</label>
            <select id="harmonySelect" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: black;">
                <optgroup label="Traditional Harmonies">
                    <option value="complementary">üîÑ Complementary</option>
                    <option value="splitComplementary">‚úÇÔ∏è Split Complementary</option>
                    <option value="triadic">‚ñ≥ Triadic</option>
                    <option value="tetradic">‚ñ° Tetradic</option>
                    <option value="analogous">‚Üí Analogous</option>
                </optgroup>
                <optgroup label="Wave-Based Innovations">
                    <option value="beatPattern">ü•Å Beat Pattern</option>
                    <option value="harmonicSeries">üéº Harmonic Series</option>
                    <option value="dopplerShift">üåÄ Doppler Shift</option>
                    <option value="standingWave">„Ä∞Ô∏è Standing Wave</option>
                </optgroup>
            </select>

            <h2 style="margin-top: 30px;">üé® Live Color Palette</h2>
            <div class="color-palette" id="colorPalette"></div>
        </div>
    </div>

    <script>
        // Audio System - WORKING VERSION
        const canvas = document.getElementById('audioCanvas');
        const canvasCtx = canvas.getContext('2d');
        let audioContext = null;
        let analyser = null;
        let dataArray = null;
        let isAudioRunning = false;
        let isReactiveMode = true;
        let animationFrameId = null;

        const startAudioBtn = document.getElementById('startAudioBtn');
        const stopAudioBtn = document.getElementById('stopAudioBtn');
        const toggleReactiveBtn = document.getElementById('toggleReactiveBtn');

        // Set canvas size
        function resizeCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Audio setup - WORKING VERSION from wb-color-organ
        async function startAudio() {
            try {
                console.log('üéµ Requesting tab audio access...');
                console.log('üì∫ SELECT THE TAB with music/audio');
                console.log('‚úÖ Make sure to CHECK "Share audio" checkbox!');

                if (!audioContext) {
                    // Capture browser tab audio - requires BOTH video and audio per Chrome API
                    const stream = await navigator.mediaDevices.getDisplayMedia({
                        video: true,  // CRITICAL: Required by Chrome
                        audio: {
                            echoCancellation: false,
                            noiseSuppression: false,
                            autoGainControl: false
                        }
                    });

                    // CRITICAL: Stop video track immediately (we only want audio)
                    const videoTrack = stream.getVideoTracks()[0];
                    if (videoTrack) {
                        videoTrack.stop();
                        stream.removeTrack(videoTrack);
                    }

                    // Create audio context and analyzer
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    analyser = audioContext.createAnalyser();
                    analyser.fftSize = 2048;
                    analyser.smoothingTimeConstant = 0.3;

                    dataArray = new Uint8Array(analyser.frequencyBinCount);

                    const source = audioContext.createMediaStreamSource(stream);
                    source.connect(analyser);

                    console.log('‚úÖ TAB AUDIO CAPTURE STARTED!');
                    console.log('   üé∏ Bass ‚Üí Hue shifts');
                    console.log('   üé§ Mids ‚Üí Saturation');
                    console.log('   üéº Treble ‚Üí Lightness');
                }

                isAudioRunning = true;
                startAudioBtn.disabled = true;
                stopAudioBtn.disabled = false;
                document.getElementById('inputType').textContent = 'Browser Tab';
                document.getElementById('bufferSize').textContent = analyser.fftSize;
                document.getElementById('sampleRate').textContent = audioContext.sampleRate + ' Hz';
                document.getElementById('statusText').textContent = 'üéµ Playing!';

                // Start visualization
                visualizeAudio();

            } catch (err) {
                console.error('‚ùå Audio capture error:', err);
                document.getElementById('statusText').textContent = 'Error: ' + err.name;
                alert('‚ùå Audio capture failed!\n\n' +
                      'üì∫ To capture tab audio:\n' +
                      '1. Click "üé§ Audio Tab"\n' +
                      '2. Select the tab with your music\n' +
                      '3. ‚úÖ CHECK "Share audio" checkbox\n' +
                      '4. Click "Share"\n\n' +
                      'üéµ Works with Spotify, YouTube, SoundCloud, etc!');
                startAudioBtn.disabled = false;
            }
        }

        function stopAudio() {
            isAudioRunning = false;
            if (audioContext) {
                audioContext.close();
                audioContext = null;
                analyser = null;
            }
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
            }
            startAudioBtn.disabled = false;
            stopAudioBtn.disabled = true;
            document.getElementById('inputType').textContent = 'Idle';
            document.getElementById('statusText').textContent = 'Stopped';
            console.log('‚è∏Ô∏è Audio capture stopped');
        }

        function visualizeAudio() {
            if (!isAudioRunning) return;

            analyser.getByteFrequencyData(dataArray);

            // Clear canvas
            canvasCtx.fillStyle = 'rgba(30, 30, 46, 0.2)';
            canvasCtx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw frequency bars
            const barWidth = (canvas.width / dataArray.length) * 2.5;
            let barHeight;
            let x = 0;

            for (let i = 0; i < dataArray.length; i++) {
                barHeight = (dataArray[i] / 255) * canvas.height;

                // Color gradient based on frequency
                const hue = (i / dataArray.length) * 360;
                canvasCtx.fillStyle = `hsl(${hue}, 100%, 50%)`;
                canvasCtx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);

                x += barWidth + 1;
            }

            animationFrameId = requestAnimationFrame(visualizeAudio);
        }

        // Event listeners
        startAudioBtn.addEventListener('click', startAudio);
        stopAudioBtn.addEventListener('click', stopAudio);

        toggleReactiveBtn.addEventListener('click', () => {
            isReactiveMode = !isReactiveMode;
            toggleReactiveBtn.textContent = isReactiveMode ? '‚ú® Audio Reactive ON' : 'üîá Audio Reactive OFF';
            console.log('Audio reactive mode:', isReactiveMode ? 'ON' : 'OFF');
        });

        // Color palette generator
        const harmonySelect = document.getElementById('harmonySelect');
        const colorPalette = document.getElementById('colorPalette');

        function generateColors(baseHue, mode) {
            let colors = [];

            switch(mode) {
                case 'complementary':
                    colors = [baseHue, (baseHue + 180) % 360];
                    break;
                case 'splitComplementary':
                    colors = [baseHue, (baseHue + 150) % 360, (baseHue + 210) % 360];
                    break;
                case 'triadic':
                    colors = [baseHue, (baseHue + 120) % 360, (baseHue + 240) % 360];
                    break;
                case 'tetradic':
                    colors = [baseHue, (baseHue + 90) % 360, (baseHue + 180) % 360, (baseHue + 270) % 360];
                    break;
                case 'analogous':
                    colors = [(baseHue - 30 + 360) % 360, baseHue, (baseHue + 30) % 360];
                    break;
                case 'beatPattern':
                    colors = [baseHue, (baseHue + 45) % 360, (baseHue + 90) % 360, (baseHue + 135) % 360, (baseHue + 180) % 360];
                    break;
                case 'harmonicSeries':
                    colors = [baseHue, (baseHue + 60) % 360, (baseHue + 120) % 360, (baseHue + 180) % 360, (baseHue + 240) % 360];
                    break;
                case 'dopplerShift':
                    colors = [(baseHue - 60 + 360) % 360, baseHue, (baseHue + 60) % 360];
                    break;
                case 'standingWave':
                    colors = [baseHue, (baseHue + 72) % 360, (baseHue + 144) % 360, (baseHue + 216) % 360, (baseHue + 288) % 360];
                    break;
            }

            return colors;
        }

        function updatePalette() {
            const baseHue = Math.random() * 360;
            const mode = harmonySelect.value;
            const colors = generateColors(baseHue, mode);

            colorPalette.innerHTML = '';
            colors.forEach(hue => {
                const swatch = document.createElement('div');
                swatch.className = 'color-swatch';
                swatch.style.background = `hsl(${hue}, 100%, 50%)`;
                swatch.title = `Hue: ${Math.round(hue)}¬∞`;
                colorPalette.appendChild(swatch);
            });
        }

        harmonySelect.addEventListener('change', updatePalette);
        updatePalette();

        console.log('‚úÖ Wave-Based Color Harmony Demo Ready!');
        console.log('üì∫ Click "üé§ Audio Tab" to select a tab with music...');
    </script>
</body>
</html>






