<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WB Framework AI Assistant - Enhanced</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; }
        #root { width: 100vw; height: 100vh; }
        .loading { display: flex; justify-content: center; align-items: center; height: 100vh; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: white; font-family: system-ui; font-size: 24px; }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading">üîç Loading WB Framework Knowledge Base...</div>
    </div>
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        
        // Lucide icons as inline SVGs
        const Send = ({size}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>;
        const Book = ({size}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>;
        const Code = ({size}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>;
        const Lightbulb = ({size}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="9" y1="18" x2="15" y2="18"></line><line x1="10" y1="22" x2="14" y2="22"></line><path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 18 8 6 6 0 0 0 6 8c0 1 .23 2.23 1.5 3.5A4.61 4.61 0 0 1 8.91 14"></path></svg>;
        const FileText = ({size}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>;
        const Loader = ({size, className}) => <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="2" x2="12" y2="6"></line><line x1="12" y1="18" x2="12" y2="22"></line><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line><line x1="2" y1="12" x2="6" y2="12"></line><line x1="18" y1="12" x2="22" y2="12"></line><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line></svg>;
        const Database = ({size}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><ellipse cx="12" cy="5" rx="9" ry="3"></ellipse><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path></svg>;

        const WBFrameworkAssistant = () => {
          const [knowledgeBase, setKnowledgeBase] = useState(null);
          const [messages, setMessages] = useState([]);
          const [input, setInput] = useState('');
          const [loading, setLoading] = useState(false);
          const [kbLoading, setKbLoading] = useState(true);
          const messagesEndRef = useRef(null);

          // Load knowledge base on mount
          useEffect(() => {
            loadKnowledgeBase();
          }, []);

          useEffect(() => {
            messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
          }, [messages]);

          const loadKnowledgeBase = async () => {
            try {
              const response = await fetch('/knowledge-base.json');
              if (!response.ok) {
                throw new Error('Knowledge base not found. Run: npm run build:kb');
              }
              const kb = await response.json();
              setKnowledgeBase(kb);
              
              // Set welcome message
              setMessages([{
                role: 'assistant',
                content: `Hello! I'm your **enhanced** WB Framework AI Assistant with full access to:\n\nüìö **${kb.metadata.totalDocs} Documentation Files**\nüß© **${kb.metadata.totalComponents} Components**\nüíª **${kb.metadata.totalExamples} Code Examples**\n\nI have comprehensive knowledge of your entire framework. Ask me anything!`
              }]);
              
              setKbLoading(false);
            } catch (error) {
              console.error('Failed to load knowledge base:', error);
              setMessages([{
                role: 'assistant',
                content: `‚ö†Ô∏è **Knowledge base not found!**\n\nPlease run: \`npm run build:kb\`\n\nThis will scan all your documentation and components to build the knowledge base.`
              }]);
              setKbLoading(false);
            }
          };

          const markdownToHtml = (md) => {
            return md
              .replace(/```(\w+)?\n([\s\S]*?)```/g, '<pre style="background:#1e1e2e;padding:15px;borderRadius:8px;overflow-x:auto;margin:10px 0;border:1px solid #3f3f46"><code style="color:#e4e4e7;fontSize:14px;fontFamily:\'Consolas\',\'Monaco\',monospace">$2</code></pre>')
              .replace(/`([^`]+)`/g, '<code style="background:rgba(0,0,0,0.3);padding:2px 6px;borderRadius:4px;fontSize:14px;color:#a78bfa;fontFamily:\'Consolas\',monospace">$1</code>')
              .replace(/\*\*(.+?)\*\*/g, '<strong style="color:#a78bfa">$1</strong>')
              .replace(/^### (.+)$/gm, '<h3 style="color:#a78bfa;fontSize:18px;marginTop:15px;marginBottom:8px">$1</h3>')
              .replace(/^## (.+)$/gm, '<h2 style="color:#a78bfa;fontSize:20px;marginTop:15px;marginBottom:8px">$1</h2>')
              .replace(/^# (.+)$/gm, '<h1 style="color:#a78bfa;fontSize:24px;marginTop:15px;marginBottom:8px">$1</h1>')
              .replace(/^\- (.+)$/gm, '<li style="marginLeft:20px;marginBottom:5px">$1</li>')
              .replace(/(<li.*?<\/li>\s*)+/g, '<ul style="marginTop:8px;marginBottom:8px">$&</ul>')
              .replace(/\[([^\]]+)\]\(([^\)]+)\)/g, '<a href="$2" style="color:#667eea;textDecoration:underline" target="_blank">$1</a>')
              .replace(/\n\n/g, '<br/><br/>')
              .replace(/\n/g, '<br/>');
          };

          const searchKnowledge = (query) => {
            if (!knowledgeBase) return [];
            
            const lower = query.toLowerCase();
            const tokens = lower.split(/\s+/).filter(t => t.length > 2);
            
            const results = [];
            
            // Search components
            knowledgeBase.components.forEach(comp => {
              let score = 0;
              if (tokens.some(t => comp.name.includes(t))) score += 10;
              if (tokens.some(t => comp.description.toLowerCase().includes(t))) score += 5;
              comp.keywords.forEach(kw => {
                if (tokens.some(t => kw.includes(t))) score += 3;
              });
              if (score > 0) {
                results.push({ type: 'component', data: comp, score });
              }
            });
            
            // Search documentation
            knowledgeBase.documentation.forEach(doc => {
              let score = 0;
              if (tokens.some(t => doc.title.toLowerCase().includes(t))) score += 8;
              if (tokens.some(t => doc.content.toLowerCase().includes(t))) score += 2;
              doc.keywords.forEach(kw => {
                if (tokens.some(t => kw.includes(t))) score += 3;
              });
              if (score > 0) {
                results.push({ type: 'doc', data: doc, score });
              }
            });
            
            return results.sort((a, b) => b.score - a.score).slice(0, 5);
          };

          const buildContext = (results) => {
            let context = '';
            
            results.forEach(result => {
              if (result.type === 'component') {
                const comp = result.data;
                context += `\n\n## Component: ${comp.title}\n`;
                context += `Description: ${comp.description}\n`;
                context += `Usage: ${comp.usage}\n`;
                if (comp.events.length > 0) {
                  context += `Events: ${comp.events.join(', ')}\n`;
                }
                if (comp.methods.length > 0) {
                  context += `Methods: ${comp.methods.join(', ')}\n`;
                }
                if (comp.codeExamples.length > 0) {
                  context += `\nCode Example:\n\`\`\`${comp.codeExamples[0].language}\n${comp.codeExamples[0].code.substring(0, 500)}\n\`\`\`\n`;
                }
              } else if (result.type === 'doc') {
                const doc = result.data;
                context += `\n\n## Documentation: ${doc.title}\n`;
                context += doc.content.substring(0, 800) + '...\n';
              }
            });
            
            return context;
          };

          const handleSend = async () => {
            if (!input.trim() || loading || !knowledgeBase) return;
            
            const userMsg = input.trim();
            setInput('');
            setMessages(prev => [...prev, { role: 'user', content: userMsg }]);
            setLoading(true);

            const results = searchKnowledge(userMsg);
            
            if (results.length === 0) {
              setMessages(prev => [...prev, { 
                role: 'assistant', 
                content: 'I couldn\'t find specific information about that. Try asking about:\n\n- Specific components (e.g., "how do I use wb-button?")\n- Architecture patterns\n- How-to guides\n- Code examples'
              }]);
              setLoading(false);
              return;
            }
            
            const context = buildContext(results);
            
            try {
              const response = await fetch("https://api.anthropic.com/v1/messages", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  model: "claude-sonnet-4-20250514",
                  max_tokens: 2000,
                  messages: [{
                    role: "user",
                    content: `You are an expert on the WB Framework. Answer using ONLY this context from the actual project files:

${context}

User Question: ${userMsg}

Provide a detailed answer with:
1. Direct answer to the question
2. Code examples from the actual project (if relevant)
3. References to specific files/components
4. Best practices from the documentation

Use markdown formatting. Be specific and practical.`
                  }]
                })
              });
              
              const data = await response.json();
              setMessages(prev => [...prev, { role: 'assistant', content: data.content[0].text }]);
            } catch (error) {
              // Fallback to knowledge base summary
              const summary = results.slice(0, 2).map(r => {
                if (r.type === 'component') {
                  return `**${r.data.title}**\n\n${r.data.description}\n\nUsage: \`${r.data.usage}\``;
                } else {
                  return `**${r.data.title}**\n\n${r.data.summary}`;
                }
              }).join('\n\n---\n\n');
              
              setMessages(prev => [...prev, { role: 'assistant', content: summary }]);
            } finally {
              setLoading(false);
            }
          };

          if (kbLoading) {
            return <div className="loading">üîç Loading WB Framework Knowledge Base...</div>;
          }

          const quickQuestions = [
            { icon: <Book size={16} />, text: "How do I create a new component?" },
            { icon: <Code size={16} />, text: "Show me wb-button code example" },
            { icon: <Lightbulb size={16} />, text: "What is the color harmony system?" },
            { icon: <FileText size={16} />, text: "How do events work in WB?" }
          ];

          return (
            <div style={{ display: 'flex', flexDirection: 'column', height: '100vh', background: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)', fontFamily: 'system-ui' }}>
              <div style={{ background: 'rgba(30,30,46,0.95)', padding: '20px 30px', borderBottom: '1px solid rgba(255,255,255,0.1)' }}>
                <h1 style={{ margin: 0, fontSize: '24px', background: 'linear-gradient(135deg, #667eea 0%, #a78bfa 100%)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', display: 'flex', alignItems: 'center', gap: '10px' }}>
                  <Code size={28} /> WB Framework AI Assistant
                </h1>
                <p style={{ margin: '5px 0 0 0', color: '#a1a1aa', fontSize: '14px', display: 'flex', alignItems: 'center', gap: '15px' }}>
                  <span style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>
                    <Database size={14} />
                    {knowledgeBase ? `${knowledgeBase.metadata.totalDocs} Docs` : 'No KB'}
                  </span>
                  <span>‚Ä¢</span>
                  <span>{knowledgeBase ? `${knowledgeBase.metadata.totalComponents} Components` : ''}</span>
                  <span>‚Ä¢</span>
                  <span>{knowledgeBase ? `${knowledgeBase.metadata.totalExamples} Examples` : ''}</span>
                </p>
              </div>
              
              <div style={{ flex: 1, overflowY: 'auto', padding: '20px', display: 'flex', flexDirection: 'column', gap: '15px' }}>
                {messages.map((msg, idx) => (
                  <div key={idx} style={{ display: 'flex', justifyContent: msg.role === 'user' ? 'flex-end' : 'flex-start' }}>
                    <div style={{ maxWidth: '80%', padding: '15px 20px', borderRadius: msg.role === 'user' ? '20px 20px 5px 20px' : '20px 20px 20px 5px', background: msg.role === 'user' ? 'linear-gradient(135deg, #667eea 0%, #a78bfa 100%)' : 'rgba(30,30,46,0.95)', color: msg.role === 'user' ? 'white' : '#e4e4e7', boxShadow: '0 2px 10px rgba(0,0,0,0.3)', fontSize: '15px', lineHeight: '1.6' }}>
                      <div dangerouslySetInnerHTML={{ __html: markdownToHtml(msg.content) }} />
                    </div>
                  </div>
                ))}
                {loading && (
                  <div style={{ display: 'flex', justifyContent: 'flex-start' }}>
                    <div style={{ padding: '15px 20px', borderRadius: '20px 20px 20px 5px', background: 'rgba(30,30,46,0.95)', display: 'flex', alignItems: 'center', gap: '10px' }}>
                      <Loader size={16} className="spin" />
                      <span style={{ color: '#a1a1aa' }}>Searching {knowledgeBase?.metadata.totalDocs} docs...</span>
                    </div>
                  </div>
                )}
                <div ref={messagesEndRef} />
              </div>
              
              {messages.length === 1 && (
                <div style={{ padding: '0 20px 20px 20px', display: 'flex', flexWrap: 'wrap', gap: '10px' }}>
                  {quickQuestions.map((q, idx) => (
                    <button key={idx} onClick={() => { setInput(q.text); setTimeout(handleSend, 100); }} style={{ background: 'rgba(30,30,46,0.95)', border: 'none', borderRadius: '12px', padding: '12px 16px', display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer', fontSize: '14px', color: '#a78bfa', fontWeight: '500', boxShadow: '0 2px 8px rgba(0,0,0,0.3)', transition: 'all 0.2s' }}>
                      {q.icon} {q.text}
                    </button>
                  ))}
                </div>
              )}
              
              <div style={{ padding: '20px', background: 'rgba(30,30,46,0.95)', borderTop: '1px solid rgba(255,255,255,0.1)' }}>
                <div style={{ display: 'flex', gap: '10px', maxWidth: '1200px', margin: '0 auto' }}>
                  <input type="text" value={input} onChange={(e) => setInput(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && handleSend()} placeholder="Ask about components, architecture, or code examples..." disabled={loading || !knowledgeBase} style={{ flex: 1, padding: '15px 20px', fontSize: '15px', border: '2px solid #3f3f46', borderRadius: '12px', outline: 'none', background: '#27272a', color: '#e4e4e7' }} />
                  <button onClick={handleSend} disabled={loading || !input.trim() || !knowledgeBase} style={{ padding: '15px 25px', background: loading || !input.trim() || !knowledgeBase ? '#3f3f46' : 'linear-gradient(135deg, #667eea 0%, #a78bfa 100%)', color: 'white', border: 'none', borderRadius: '12px', cursor: loading || !input.trim() ? 'not-allowed' : 'pointer', display: 'flex', alignItems: 'center', gap: '8px', fontSize: '15px', fontWeight: '600' }}>
                    <Send size={18} /> Send
                  </button>
                </div>
              </div>
              
              <style>{`@keyframes spin { to { transform: rotate(360deg); } } .spin { animation: spin 1s linear infinite; }`}</style>
            </div>
          );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<WBFrameworkAssistant />);
    </script>
</body>
</html>






