<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP API Test</title>
    <style>
        body {
            font-family: -apple-system, system-ui, sans-serif;
            line-height: 1.5;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        #output {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        button {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 20px;
        }
        .success {
            color: green;
            font-weight: bold;
        }
        .error {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>MCP API Test</h1>
    <p>This page tests the MCP API with a correctly formatted request payload.</p>
    
    <button id="testBtn">Run MCP API Test</button>
    <div id="output">Results will appear here...</div>
    
    <script>
        document.getElementById('testBtn').addEventListener('click', async () => {
            const output = document.getElementById('output');
            
            output.innerHTML = 'Running MCP API test...\n\n';
            
            // Test 1: Health check
            try {
                output.innerHTML += '1. Testing /mcp/health endpoint...\n';
                const healthResponse = await fetch('/mcp/health');
                const healthData = await healthResponse.json();
                output.innerHTML += `   <span class="success">SUCCESS</span>: Status: ${healthData.status}\n\n`;
            } catch (error) {
                output.innerHTML += `   <span class="error">ERROR</span>: ${error.message}\n\n`;
            }
            
            // Test 2: Capabilities
            try {
                output.innerHTML += '2. Testing /mcp/capabilities endpoint...\n';
                const capabilitiesResponse = await fetch('/mcp/capabilities');
                const capabilitiesData = await capabilitiesResponse.json();
                output.innerHTML += `   <span class="success">SUCCESS</span>: Found ${capabilitiesData.capabilities?.websiteTypes?.length || 0} website types\n\n`;
            } catch (error) {
                output.innerHTML += `   <span class="error">ERROR</span>: ${error.message}\n\n`;
            }
            
            // Test 3: Validation with valid input
            try {
                output.innerHTML += '3. Testing /mcp/validate endpoint...\n';
                const validInput = {
                    website: { type: 'portfolio' },
                    content: { title: 'Test Website' },
                    output: { format: 'files' }
                };
                
                const validateResponse = await fetch('/mcp/validate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(validInput)
                });
                
                const validateData = await validateResponse.json();
                output.innerHTML += `   <span class="success">SUCCESS</span>: Validation result: ${validateData.valid}\n\n`;
            } catch (error) {
                output.innerHTML += `   <span class="error">ERROR</span>: ${error.message}\n\n`;
            }
            
            // Test 4: Generate website
            try {
                output.innerHTML += '4. Testing /mcp/generate endpoint...\n';
                
                // This is the correctly formatted payload according to WebsiteGeneratorInput interface
                const generateInput = {
                    toolName: "claude-ai-website-builder",
                    website: {
                        type: "portfolio",
                        features: ["table-theme", "theme-generator"]
                    },
                    content: {
                        title: "Test Portfolio",
                        description: "A test portfolio website"
                    },
                    output: {
                        format: "files"
                    },
                    customization: {
                        primaryColor: "#3b82f6",
                        secondaryColor: "#f8fafc", 
                        accentColor: "#10b981"
                    }
                };
                
                output.innerHTML += `   Sending payload:\n   ${JSON.stringify(generateInput, null, 2)}\n\n`;
                
                const generateResponse = await fetch('/mcp/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(generateInput)
                });
                
                if (!generateResponse.ok) {
                    const errorText = await generateResponse.text();
                    let errorObj;
                    try {
                        errorObj = JSON.parse(errorText);
                    } catch (e) {
                        errorObj = { error: errorText };
                    }
                    throw new Error(`HTTP error ${generateResponse.status}: ${errorObj.error || errorText}`);
                }
                
                const generateData = await generateResponse.json();
                
                output.innerHTML += `   <span class="success">SUCCESS</span>: Generated ${generateData.files.length} files\n`;
                output.innerHTML += `   Generated files:\n`;
                generateData.files.forEach(file => {
                    output.innerHTML += `   - ${file.path} (${file.content.length} bytes)\n`;
                });
                output.innerHTML += '\n';
            } catch (error) {
                output.innerHTML += `   <span class="error">ERROR</span>: ${error.message}\n\n`;
            }
            
            output.innerHTML += 'MCP API testing completed.';
        });
    </script>
</body>
</html>
