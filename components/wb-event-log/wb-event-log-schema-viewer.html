<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß WB Event Log Schema Viewer - Loop Prevention Edition</title>
    
    <!-- Foundation Styles -->
    <link rel="stylesheet" href="..../styles/main.css">
    
    <!-- Component Styles -->
    <link rel="stylesheet" href="wb-event-log.css">
</head>

<body>
    <div class="demo-container fade-in-up">
        <!-- Header -->
        <header class="demo-header">
            <h1 class="demo-title">ÔøΩ WB Event Log Schema Viewer</h1>
            <p class="demo-subtitle">
                Professional schema documentation with <strong>üõ°Ô∏è built-in loop detection and prevention</strong>. 
                The wb-event-log now automatically detects and stops infinite console loops, preventing stack overflows.
                Features dynamic schema-based control generation and comprehensive error capture.
            </p>
        </header>

        <!-- Tab Navigation -->
        <wb-tab data-initial-tab="schema">
            <div slot="tabs">
                <button data-tab="schema">Schema</button>
                <button data-tab="examples">Examples</button>
                <button data-tab="validator">Validator</button>
                <button data-tab="viewer">Event Viewer</button>
                <button data-tab="generator">üéõÔ∏è Dynamic Control</button>
                <button data-tab="docs">Documentation</button>
            </div>

            <!-- Schema Tab -->
            <div slot="content" data-tab="schema">
                <wb-card class="demo-section">
                    <h2 class="section-title">üìã Schema Structure</h2>
                    <p class="section-description">Comprehensive JSON schema defining the complete configuration structure for the wb-event-log component. Explore properties, types, and validation rules.</p>
                
                <!-- Statistics -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-value" id="totalProperties">0</span>
                        <span class="stat-label">Properties</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="enumCount">0</span>
                        <span class="stat-label">Enums</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="defaultCount">0</span>
                        <span class="stat-label">Defaults</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="booleanCount">0</span>
                        <span class="stat-label">Booleans</span>
                    </div>
                </div>

                <!-- Search -->
                <input type="text" class="search-input" id="schemaSearch" placeholder="Search schema properties...">
                
                <!-- Schema Display -->
                <div class="schema-tree" id="schemaTree">
                    <div class="loading">Loading schema structure...</div>
                </div>
                </wb-card>
            </div>

            <!-- Examples Tab -->
            <div slot="content" data-tab="examples">
                <wb-card class="demo-section">
                    <h2 class="section-title">üìù Configuration Examples</h2>
                    <p class="section-description">Production-ready configuration examples demonstrating common usage patterns, from basic setups to advanced configurations with custom styling and event handling.</p>
                
                <div class="doc-section">
                    <h3>Basic Configuration</h3>
                    <wb-btn class="copy-btn" variant="secondary" onclick="copyExample('basic')">Copy</wb-btn>
                    <div class="json-viewer" id="basicExample"></div>
                </div>

                <div class="doc-section">
                    <h3>Advanced Configuration</h3>
                    <wb-btn class="copy-btn" variant="secondary" onclick="copyExample('advanced')">Copy</wb-btn>
                    <div class="json-viewer" id="advancedExample"></div>
                </wb-card>
            </div>

            <!-- Validator Tab -->
            <div slot="content" data-tab="validator">
                <wb-card class="demo-section">
                    <h2 class="section-title">‚úÖ JSON Configuration Validator</h2>
                    <p class="section-description">
                        Validate your wb-event-log component configurations against the official schema. Paste your JSON below to check for compliance and get detailed error reporting.
                    </p>

                <div class="control-group">
                    <label class="control-label" for="jsonInput">JSON Configuration</label>
                    <textarea id="jsonInput" class="validator-textarea" placeholder="Paste your JSON configuration here..."></textarea>
                </div>

                <div class="action-buttons">
                    <wb-btn variant="primary" onclick="validateJSON()">Validate</wb-btn>
                    <wb-btn variant="secondary" onclick="clearValidator()">Clear</wb-btn>
                    <wb-btn variant="secondary" onclick="loadSample()">Load Sample</wb-btn>
                </div>

                <div id="validationResult" class="validation-result" style="display: none;"></div>
                </wb-card>
            </div>

            <!-- Dynamic Control Generator Tab -->
            <div slot="content" data-tab="generator">
                <wb-card class="demo-section">
                    <h2 class="section-title">üéõÔ∏è Dynamic Schema-Based Control Generator</h2>
                    <p class="section-description">
                        This dynamic control panel is automatically generated from the wb-event-log JSON schema. 
                        Each property becomes an interactive control, demonstrating real-time schema-driven UI generation.
                        <strong>All controls below are dynamically created based on the actual schema properties!</strong>
                    </p>
                    
                    <!-- Schema-Generated Controls -->
                    <div id="dynamicControls" class="dynamic-controls">
                        <div class="loading">Generating controls from schema...</div>
                    </div>
                    
                    <!-- Live Preview -->
                    <div class="control-group">
                        <h3>üî¥ Live Preview (Generated Configuration)</h3>
                        <p>This wb-event-log component is configured using the controls above:</p>
                        <wb-event-log id="dynamicEventLog"></wb-event-log>
                    </div>
                    
                    <!-- Generated JSON Output -->
                    <div class="control-group">
                        <h3>üìã Generated JSON Configuration</h3>
                        <div class="json-viewer" id="generatedConfig">{}</div>
                        <wb-btn variant="secondary" onclick="copyGeneratedConfig()">Copy Configuration</wb-btn>
                        <wb-btn variant="primary" onclick="applyDynamicConfig()">Apply to Preview</wb-btn>
                    </div>
                </wb-card>
            </div>

            <!-- Event Viewer Tab -->
            <div slot="content" data-tab="viewer">
                <wb-card class="demo-section">
                    <h2 class="section-title">üî¥ Live Event Viewer</h2>
                    <p class="section-description">
                        Interactive demonstration showcasing the wb-event-log component in action with real-time event generation, statistics tracking, and professional event management controls.
                    </p>

                    <!-- Event Generation Controls -->
                    <div class="action-buttons">
                        <wb-btn variant="primary" onclick="generateTestEvent('info')">Generate Info</wb-btn>
                        <wb-btn variant="warning" onclick="generateTestEvent('warning')">Generate Warning</wb-btn>
                        <wb-btn variant="danger" onclick="generateTestEvent('error')">Generate Error</wb-btn>
                        <wb-btn variant="success" onclick="generateTestEvent('success')">Generate Success</wb-btn>
                        <wb-btn variant="secondary" onclick="clearEventLog()">Clear Log</wb-btn>
                        <wb-btn variant="secondary" onclick="exportEventLog()">Export Events</wb-btn>
                    </div>

                    <!-- Live Event Log -->
                    <wb-event-log 
                        id="liveEventLog"
                        max-events="100"
                        auto-scroll="true"
                        show-timestamps="true"
                        show-source="true"
                        expandable-details="true"
                        toolbar="true"
                        search="true"
                        filters="true"
                        export="true">
                    </wb-event-log>

                    <!-- Event Statistics -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <span class="stat-value" id="liveEventCount">0</span>
                            <span class="stat-label">Total Events</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-value" id="liveErrorCount">0</span>
                            <span class="stat-label">Errors</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-value" id="liveWarningCount">0</span>
                            <span class="stat-label">Warnings</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-value" id="liveInfoCount">0</span>
                            <span class="stat-label">Info</span>
                        </div>
                    </div>
                </wb-card>
            </div>

        <!-- Documentation Tab -->
        <section class="tab-content" data-tab="docs">
            <div class="demo-section">
                <div class="documentation">
                    <div class="doc-section">
                        <h3>Schema Overview</h3>
                        <p>
                            This JSON Schema defines all configurable attributes for the wb-event-log web component.
                            It includes type validation, default values, and documentation for each property.
                        </p>
                    </div>

                    <div class="doc-section">
                        <h3>Usage</h3>
                        <div class="code-example">&lt;wb-event-log 
    max-events="1000"
    auto-scroll="true"
    dark-mode="auto"
    wrap-mode="truncate"&gt;
&lt;/wb-event-log&gt;</div>
                    </div>

                    <div class="doc-section">
                        <h3>Key Features</h3>
                        <ul>
                            <li><strong>Type Safety</strong> - Validates all attribute types</li>
                            <li><strong>Default Values</strong> - Provides sensible defaults</li>
                            <li><strong>Enumerations</strong> - Restricts values to valid options</li>
                            <li><strong>Documentation</strong> - Describes each property</li>
                        </ul>
                    </div>
                </wb-card>
            </div>
        </wb-tab>
    </div>

    <!-- WB Components -->
    <script src="..../styles/wb-components.js"></script>
    <script src="wb-event-log.js"></script>
    
    <!-- Schema Viewer Script -->
    <script>
        let schema = null;
        let stats = { properties: 0, enums: 0, defaults: 0, booleans: 0 };

        // Tab management is now handled by wb-tab component
        // No custom tab management needed

        // Load schema
        async function loadSchema() {
            try {
                const response = await fetch('wb-event-log.schema.json');
                schema = await response.json();
                renderSchema();
                generateExamples();
                updateStats();
                
                // Set up event log listeners after schema loads
                setTimeout(() => {
                    const eventLog = document.getElementById('liveEventLog');
                    if (eventLog) {
                        eventLog.addEventListener('wb-event-logged', (e) => {
                            console.log('Event logged in viewer:', e.detail);
                        });
                        
                        eventLog.addEventListener('wb-events-cleared', () => {
                            console.log('Event log cleared');
                        });
                    }
                }, 1000);
                
            } catch (error) {
                console.error('Failed to load schema:', error);
                document.getElementById('schemaTree').innerHTML = 
                    '<div style="color: var(--error-color);">Failed to load schema file.</div>';
            }
        }

        // Render schema
        function renderSchema() {
            if (!schema || !schema.properties) return;

            const container = document.getElementById('schemaTree');
            container.innerHTML = '';

            Object.entries(schema.properties).forEach(([key, prop]) => {
                renderProperty(key, prop, container);
            });
        }

        // Render property
        function renderProperty(key, prop, container) {
            const div = document.createElement('div');
            div.className = 'schema-property';

            let html = `<span class="schema-key">${key}</span>`;
            
            if (prop.type) {
                html += `<span class="schema-type">${prop.type}</span>`;
                if (prop.type === 'boolean') stats.booleans++;
            }

            if (prop.enum) {
                html += `<span class="schema-enum">[${prop.enum.join(', ')}]</span>`;
                stats.enums++;
            }

            if (prop.default !== undefined) {
                html += `<span class="schema-default">default: ${JSON.stringify(prop.default)}</span>`;
                stats.defaults++;
            }

            div.innerHTML = html;

            if (prop.description) {
                const desc = document.createElement('div');
                desc.className = 'schema-description';
                desc.textContent = prop.description;
                div.appendChild(desc);
            }

            container.appendChild(div);
            stats.properties++;
        }

        // Generate examples
        function generateExamples() {
            const basic = {
                "max-events": 1000,
                "auto-scroll": true,
                "show-timestamps": true,
                "dark-mode": "auto"
            };

            const advanced = {
                "max-events": 500,
                "auto-scroll": true,
                "show-timestamps": true,
                "show-source": true,
                "expandable-details": true,
                "compact": false,
                "dark-mode": "auto",
                "wrap-mode": "truncate",
                "toolbar": true,
                "search": true,
                "filters": true,
                "export": true,
                "intercept-console": true,
                "capture-errors": true
            };

            document.getElementById('basicExample').innerHTML = syntaxHighlight(JSON.stringify(basic, null, 2));
            document.getElementById('advancedExample').innerHTML = syntaxHighlight(JSON.stringify(advanced, null, 2));
        }

        // Syntax highlighting
        function syntaxHighlight(json) {
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, 
                function (match) {
                    let cls = 'json-number';
                    if (/^"/.test(match)) {
                        cls = /:$/.test(match) ? 'json-key' : 'json-string';
                    } else if (/true|false/.test(match)) {
                        cls = 'json-boolean';
                    } else if (/null/.test(match)) {
                        cls = 'json-null';
                    }
                    return '<span class="' + cls + '">' + match + '</span>';
                });
        }

        // Update statistics
        function updateStats() {
            document.getElementById('totalProperties').textContent = stats.properties;
            document.getElementById('enumCount').textContent = stats.enums;
            document.getElementById('defaultCount').textContent = stats.defaults;
            document.getElementById('booleanCount').textContent = stats.booleans;
        }

        // Copy functions
        function copyExample(type) {
            const elementId = type + 'Example';
            const element = document.getElementById(elementId);
            const text = element.textContent;
            navigator.clipboard.writeText(text).then(() => {
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                setTimeout(() => button.textContent = originalText, 2000);
            });
        }

        // Validation functions
        function validateJSON() {
            const input = document.getElementById('jsonInput').value.trim();
            const resultDiv = document.getElementById('validationResult');

            if (!input) {
                showValidationResult('Please enter JSON to validate.', false);
                return;
            }

            try {
                const data = JSON.parse(input);
                const isValid = validateAgainstSchema(data);
                showValidationResult(
                    isValid ? '‚úì Configuration is valid!' : '‚úó Configuration has issues.',
                    isValid
                );
            } catch (error) {
                showValidationResult(`‚úó Invalid JSON: ${error.message}`, false);
            }
        }

        function validateAgainstSchema(data) {
            if (!schema || !schema.properties) return false;
            
            // Basic validation - check if properties exist in schema
            const validKeys = Object.keys(schema.properties);
            const dataKeys = Object.keys(data);
            
            return dataKeys.every(key => validKeys.includes(key));
        }

        function showValidationResult(message, isValid) {
            const resultDiv = document.getElementById('validationResult');
            resultDiv.className = `validation-result ${isValid ? 'valid' : 'invalid'}`;
            resultDiv.textContent = message;
            resultDiv.style.display = 'block';
        }

        function clearValidator() {
            document.getElementById('jsonInput').value = '';
            document.getElementById('validationResult').style.display = 'none';
        }

        function loadSample() {
            const sample = JSON.stringify({
                "max-events": 1000,
                "auto-scroll": true,
                "show-timestamps": true,
                "dark-mode": "auto",
                "wrap-mode": "truncate"
            }, null, 2);
            document.getElementById('jsonInput').value = sample;
        }

        // Search functionality
        document.getElementById('schemaSearch').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            const properties = document.querySelectorAll('.schema-property');
            
            properties.forEach(prop => {
                const key = prop.querySelector('.schema-key');
                const text = key.textContent.toLowerCase();
                
                if (!query || text.includes(query)) {
                    prop.style.display = 'block';
                    if (query) {
                        const regex = new RegExp(`(${query})`, 'gi');
                        key.innerHTML = key.textContent.replace(regex, '<span class="highlight">$1</span>');
                    }
                } else {
                    prop.style.display = 'none';
                }
            });
        });

        // Event Viewer Functions
        let eventCounter = 0;
        let liveStats = { total: 0, info: 0, warning: 0, error: 0, success: 0 };

        function generateTestEvent(type) {
            const messages = {
                info: [
                    'Schema property validated successfully',
                    'Component configuration loaded',
                    'Event viewer initialized',
                    'User navigated to ' + type + ' tab',
                    'Schema statistics updated'
                ],
                warning: [
                    'Deprecated property detected in schema',
                    'Large JSON payload may impact performance',
                    'Missing optional property description',
                    'Schema validation took longer than expected',
                    'Browser compatibility warning for feature'
                ],
                error: [
                    'Failed to validate JSON against schema',
                    'Invalid property type in configuration',
                    'Required property missing from schema',
                    'Schema parsing error encountered',
                    'Component initialization failed'
                ],
                success: [
                    'Schema loaded and parsed successfully',
                    'JSON validation completed without errors',
                    'Configuration exported successfully',
                    'All schema properties validated',
                    'Event log export completed'
                ]
            };

            const typeMessages = messages[type] || messages.info;
            const message = typeMessages[Math.floor(Math.random() * typeMessages.length)];
            
            // Dispatch custom event
            document.dispatchEvent(new CustomEvent(`wb:${type}`, {
                detail: {
                    message: message,
                    source: 'schema-viewer',
                    timestamp: new Date().toISOString(),
                    eventId: ++eventCounter,
                    component: 'event-log-schema-viewer',
                    data: {
                        schemaProperty: Object.keys(schema?.properties || {})[Math.floor(Math.random() * 10)],
                        userAction: 'manual-generation',
                        sessionId: 'schema-viewer-' + Date.now()
                    }
                }
            }));

            // Update statistics
            liveStats.total++;
            liveStats[type]++;
            updateLiveStats();
        }

        function clearEventLog() {
            const eventLog = document.getElementById('liveEventLog');
            if (eventLog && eventLog.clearEvents) {
                eventLog.clearEvents();
            }
            // Reset statistics
            liveStats = { total: 0, info: 0, warning: 0, error: 0, success: 0 };
            updateLiveStats();
        }

        function exportEventLog() {
            const eventLog = document.getElementById('liveEventLog');
            if (eventLog && eventLog.exportEvents) {
                eventLog.exportEvents('json');
            }
        }

        function updateLiveStats() {
            document.getElementById('liveEventCount').textContent = liveStats.total;
            document.getElementById('liveErrorCount').textContent = liveStats.error;
            document.getElementById('liveWarningCount').textContent = liveStats.warning;
            document.getElementById('liveInfoCount').textContent = liveStats.info;
        }

        // Auto-generate some events for demonstration
        function startEventDemo() {
            // Generate initial events
            setTimeout(() => generateTestEvent('info'), 1000);
            setTimeout(() => generateTestEvent('success'), 2000);
            setTimeout(() => generateTestEvent('warning'), 3000);
            
            // Random event generation
            setInterval(() => {
                if (Math.random() < 0.3) { // 30% chance every 5 seconds
                    const types = ['info', 'warning', 'error', 'success'];
                    const randomType = types[Math.floor(Math.random() * types.length)];
                    generateTestEvent(randomType);
                }
            }, 5000);
        }

        // Initialize with professional loading states
        document.addEventListener('DOMContentLoaded', () => {
            // Add fade-in animation to container
            document.querySelector('.demo-container').classList.add('fade-in-up');
            
            // Load schema with loading state
            loadSchema();
            
            // Initialize examples with professional formatting
            initializeExamples();
            
            // Start demo events after components are ready
            setTimeout(() => {
                startEventDemo();
                console.log('üöÄ WB Event Log Schema Viewer initialized successfully');
            }, 2000);
            
            // Add professional interactions
            addProfessionalTouches();
        });

        function initializeExamples() {
            // Add loading states to example containers
            const basicExample = document.getElementById('basicExample');
            const advancedExample = document.getElementById('advancedExample');
            
            if (basicExample) basicExample.innerHTML = '<div class="loading">Loading basic example...</div>';
            if (advancedExample) advancedExample.innerHTML = '<div class="loading">Loading advanced example...</div>';
            
            // Load examples after a brief delay for better UX
            setTimeout(() => {
                if (basicExample) {
                    basicExample.innerHTML = JSON.stringify(sampleConfigs.basic, null, 2);
                }
                if (advancedExample) {
                    advancedExample.innerHTML = JSON.stringify(sampleConfigs.advanced, null, 2);
                }
            }, 800);
        }

        function addProfessionalTouches() {
            // Add hover effects to stat cards
            document.querySelectorAll('.stat-card').forEach(card => {
                card.addEventListener('mouseenter', () => {
                    card.style.transform = 'translateY(-4px)';
                });
                card.addEventListener('mouseleave', () => {
                    card.style.transform = 'translateY(0)';
                });
            });

            // Add professional tooltips
            document.querySelectorAll('[data-tooltip]').forEach(element => {
                element.addEventListener('mouseenter', showTooltip);
                element.addEventListener('mouseleave', hideTooltip);
            });
        }

        function showTooltip(event) {
            // Simple tooltip implementation
            console.log('Tooltip:', event.target.dataset.tooltip);
        }

        function hideTooltip() {
            // Hide tooltip
        }
    </script>
</body>
</html>
