<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>wb-resize-updown - Correct Behavior</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: #1e293b;
            color: #e2e8f0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* TOP PANEL - Shows top of content, scrollable */
        #top-panel {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            overflow-anchor: none; /* Prevent scroll anchoring */
            scroll-behavior: auto; /* Disable smooth scrolling */
            padding: 2rem;
            background: #1e293b;
            min-height: 0; /* Critical: allows shrinking below content size */
        }

        #top-panel * {
            scroll-margin: 0; /* Prevent scroll margin on children */
        }

        /* Scroll to top on any interaction */
        #top-panel.resizing {
            /* Optional: could add visual indicator during resize */
        }

        h1 {
            margin-bottom: 1rem;
            color: #10b981;
        }

        .content-block {
            background: #0f172a;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border: 2px solid #334155;
        }

        .highlight-box {
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid #10b981;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
        }

        /* BOTTOM PANEL - Shows top of content, scrollable */
        #bottom-panel {
            position: relative;
            height: 250px;
            background: #0f172a;
            border-top: 2px solid #6366f1;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
        }

        /* Resize handle container */
        #resize-handle-area {
            height: 40px;
            background: #0f172a;
            border-bottom: 1px solid #334155;
            flex-shrink: 0;
            position: relative;
        }

        #bottom-panel-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            overflow-anchor: none; /* Prevent scroll anchoring */
            scroll-behavior: auto; /* Disable smooth scrolling */
            padding: 1rem;
            background: #0f172a;
        }

        #bottom-panel-content * {
            scroll-margin: 0; /* Prevent scroll margin on children */
        }

        .log-entry {
            padding: 0.5rem;
            margin: 0.25rem 0;
            background: #1e293b;
            border-left: 3px solid #6366f1;
            border-radius: 4px;
            font-size: 0.875rem;
        }

        .log-highlight {
            background: rgba(99, 102, 241, 0.1);
            border-color: #6366f1;
            font-weight: 600;
        }

        code {
            background: rgba(99, 102, 241, 0.2);
            padding: 0.125rem 0.375rem;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <!-- TOP PANEL - Always shows top of content -->
    <div id="top-panel">
        <div class="highlight-box">
            <h1>‚¨ÜÔ∏è TOP PANEL - Always Anchored to Top</h1>
            <p><strong>This panel always shows its top content.</strong></p>
            <p style="margin-top: 0.5rem;">When you drag the resize handle:</p>
            <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                <li><strong>Drag UP</strong> ‚Üí Less of this panel visible (but top stays anchored)</li>
                <li><strong>Drag DOWN</strong> ‚Üí More of this panel visible</li>
            </ul>
        </div>

        <div class="content-block">
            <h2>üéØ How It Works</h2>
            <p>This is the <strong>TOP PANEL</strong>. It has <code>flex: 1</code> and <code>overflow-y: auto</code>.</p>
            <p style="margin-top: 0.5rem;">As the bottom panel grows, this panel's visible area shrinks, but the <strong>top always stays visible</strong>.</p>
            <p style="margin-top: 0.5rem;">If there's more content than fits, you can scroll down to see it.</p>
        </div>

        <div class="content-block">
            <h2>üìê Resize Behavior</h2>
            <p>The resize handle is at the <strong>TOP of the bottom panel</strong>.</p>
            <p style="margin-top: 0.5rem;">Drag it to change the split between top and bottom panels.</p>
        </div>

        <div class="content-block">
            <h2>üìù Sample Content Block 1</h2>
            <p>This demonstrates scrollable content in the top panel.</p>
            <p style="margin-top: 0.5rem;">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
        </div>

        <div class="content-block">
            <h2>üåü Sample Content Block 2</h2>
            <p>More scrollable content.</p>
            <p style="margin-top: 0.5rem;">Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
        </div>

        <div class="content-block">
            <h2>‚ö° Sample Content Block 3</h2>
            <p>Even more content to demonstrate scrolling.</p>
            <p style="margin-top: 0.5rem;">Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.</p>
        </div>

        <div class="content-block">
            <h2>üé® Sample Content Block 4</h2>
            <p>Last block in the top panel.</p>
            <p style="margin-top: 0.5rem;">Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
        </div>
    </div>

    <!-- BOTTOM PANEL - Always shows top of content -->
    <div id="bottom-panel">
        <!-- Resize handle in its own container -->
        <div id="resize-handle-area">
            <wb-resize-updown 
                storage-key="split-panel-height"
                min-height="100"
                max-height="600"
                handle-height="40px">
            </wb-resize-updown>
        </div>
        
        <!-- Bottom panel content - always shows top -->
        <div id="bottom-panel-content">
            <div class="log-entry log-highlight">
                <strong>‚¨áÔ∏è BOTTOM PANEL - Always Anchored to Top</strong>
            </div>
            <div class="log-entry log-highlight">
                <strong>üëÜ Hover over the TOP EDGE to resize!</strong>
            </div>
            <div class="log-entry">
                üìê <strong>Drag UP</strong> = Bottom panel taller (more visible) + Top panel shorter (less visible)
            </div>
            <div class="log-entry">
                üìê <strong>Drag DOWN</strong> = Bottom panel shorter (less visible) + Top panel taller (more visible)
            </div>
            <div class="log-entry">
                ‚úÖ Both panels always show their top content
            </div>
            <div class="log-entry">
                üìú Both panels are independently scrollable
            </div>
            <div class="log-entry">
                üîç Event log entry 1
            </div>
            <div class="log-entry">
                üîç Event log entry 2
            </div>
            <div class="log-entry">
                üîç Event log entry 3
            </div>
            <div class="log-entry">
                üîç Event log entry 4
            </div>
            <div class="log-entry">
                üîç Event log entry 5
            </div>
            <div class="log-entry">
                üîç Event log entry 6
            </div>
            <div class="log-entry">
                üîç Event log entry 7
            </div>
            <div class="log-entry">
                üîç Event log entry 8 - Scroll down to see more
            </div>
            <div class="log-entry">
                üîç Event log entry 9
            </div>
            <div class="log-entry">
                üîç Event log entry 10 - Last entry
            </div>
        </div>
    </div>

    <!-- Load the component -->
    <script type="module" src="./wb-resize-updown.js"></script>
    
    <script>
        // PREVENT browser scroll restoration
        if ('scrollRestoration' in history) {
            history.scrollRestoration = 'manual';
        }
        
        const bottomPanel = document.getElementById('bottom-panel');
        const topPanel = document.getElementById('top-panel');
        const bottomContent = document.getElementById('bottom-panel-content');
        
        // Aggressive scroll prevention - lock to top for first 2 seconds
        let lockScrollToTop = true;
        
        function forceScrollToTop() {
            if (lockScrollToTop) {
                topPanel.scrollTop = 0;
                bottomContent.scrollTop = 0;
            }
        }
        
        // Force scroll to top immediately
        forceScrollToTop();
        
        // Monitor scroll events and force back to top
        topPanel.addEventListener('scroll', forceScrollToTop, { passive: true });
        bottomContent.addEventListener('scroll', forceScrollToTop, { passive: true });
        
        // Force repeatedly for first 2 seconds
        const forceInterval = setInterval(forceScrollToTop, 10);
        
        // After 2 seconds, unlock and allow manual scrolling
        setTimeout(() => {
            lockScrollToTop = false;
            clearInterval(forceInterval);
            topPanel.removeEventListener('scroll', forceScrollToTop);
            bottomContent.removeEventListener('scroll', forceScrollToTop);
            console.log('‚úÖ Scroll lock released - you can now scroll manually');
        }, 2000);
        
        // Keep both panels scrolled to top during resize
        bottomPanel.addEventListener('wb:resize-start', (e) => {
            console.log('üñ±Ô∏è Resize started:', e.detail);
            topPanel.classList.add('resizing');
            
            // Reset both panels to show their tops
            topPanel.scrollTop = 0;
            bottomContent.scrollTop = 0;
        });
        
        bottomPanel.addEventListener('wb:resizing', (e) => {
            // Keep both panels anchored to their tops while resizing
            topPanel.scrollTop = 0;
            bottomContent.scrollTop = 0;
        });
        
        bottomPanel.addEventListener('wb:resize-end', (e) => {
            console.log('‚úÖ Resize ended. Final height:', e.detail.finalHeight + 'px');
            topPanel.classList.remove('resizing');
            
            // Don't add any DOM elements - just log to console
            // Adding DOM elements causes unwanted scrolling
        });

        // Don't add welcome message - causes scroll
        // Just use the static HTML content
    </script>
</body>
</html>
