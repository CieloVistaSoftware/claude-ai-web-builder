<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WB Component Ecosystem - Final Integration Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', monospace;
            background: #0f1419;
            color: #f8f8f2;
            padding: 20px;
            margin: 0;
            line-height: 1.6;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #1e1e1e;
            border-radius: 12px;
            border: 2px solid #00ff41;
        }
        
        .test-section {
            background: #1e1e1e;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .component-test {
            background: #2a2a2a;
            border: 1px solid #555;
            border-radius: 8px;
            padding: 15px;
        }
        
        .component-test h3 {
            color: #00ff41;
            margin: 0 0 15px 0;
        }
        
        .test-result {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 12px;
            margin: 5px 5px 5px 0;
        }
        
        .pass { background: #00ff41; color: #000; }
        .fail { background: #ff4757; color: #fff; }
        .loading { background: #ffa502; color: #000; }
        
        .demo-nav {
            margin: 20px 0;
            padding: 15px;
            background: #2a2a2a;
            border-radius: 8px;
        }
        
        .demo-colors {
            margin: 20px 0;
            padding: 15px;
            background: #2a2a2a;
            border-radius: 8px;
        }
        
        .log-console {
            background: #000;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-top: 20px;
        }
        
        .control-panel-demo {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 280px;
            z-index: 1000;
        }
        
        /* Make the test obvious when it's working */
        body.ecosystem-ready {
            border: 3px solid #00ff41;
        }
        
        .success-banner {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 255, 65, 0.9);
            color: #000;
            padding: 20px 40px;
            border-radius: 12px;
            font-size: 24px;
            font-weight: bold;
            z-index: 10000;
            display: none;
        }
        
        .component-instance {
            border: 1px dashed #666;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üß™ WB Component Ecosystem - Final Integration Test</h1>
            <p>Testing all integrated components in a real-world scenario</p>
            <div id="overall-status">Initializing...</div>
        </div>

        <div class="test-section">
            <h2>üìã Component Integration Tests</h2>
            <div class="test-grid">
                <div class="component-test">
                    <h3>üîß WBComponentRegistry</h3>
                    <div id="registry-test">
                        <span class="test-result loading">LOADING</span>
                        <p>Testing component registry initialization and methods...</p>
                    </div>
                </div>

                <div class="component-test">
                    <h3>üéõÔ∏è Control Panel</h3>
                    <div id="control-panel-test">
                        <span class="test-result loading">LOADING</span>
                        <p>Testing control panel component creation and methods...</p>
                    </div>
                </div>

                <div class="component-test">
                    <h3>üß≠ wb-nav Component</h3>
                    <div id="nav-test">
                        <span class="test-result loading">LOADING</span>
                        <p>Testing wb-nav custom element creation and configuration...</p>
                    </div>
                </div>

                <div class="component-test">
                    <h3>üé® Color Components</h3>
                    <div id="color-test">
                        <span class="test-result loading">LOADING</span>
                        <p>Testing wb-color-bars and wb-color-bar integration...</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>üöÄ Live Component Demos</h2>
            
            <div class="demo-nav">
                <h3>Navigation Demo</h3>
                <p>Live wb-nav component with different configurations:</p>
                <wb-nav id="demo-nav-horizontal" 
                        layout="horizontal" 
                        variant="default"
                        items='[{"id":"home","text":"Home","href":"#home","active":true},{"id":"about","text":"About","href":"#about"},{"id":"services","text":"Services","href":"#services"}]'>
                </wb-nav>
            </div>

            <div class="demo-colors">
                <h3>Color System Demo</h3>
                <p>Live wb-color-bars component:</p>
                <wb-color-bars id="demo-color-bars"
                               text-hue="240"
                               text-saturation="70"
                               text-lightness="50"
                               theme="dark">
                </wb-color-bars>
            </div>
        </div>

        <div class="test-section">
            <h2>üìä Test Results Summary</h2>
            <div id="test-summary">
                <p>Running comprehensive integration tests...</p>
                <div id="summary-results"></div>
            </div>
        </div>

        <div class="test-section">
            <h2>üìù Test Console</h2>
            <div class="log-console" id="test-console">
                Starting WB Component Ecosystem Integration Test...\n
            </div>
        </div>
    </div>

    <!-- Control Panel for interactive testing -->
    <control-panel id="test-control-panel" class="control-panel-demo"></control-panel>

    <!-- Success Banner -->
    <div class="success-banner" id="success-banner">
        ‚úÖ ALL TESTS PASSED - ECOSYSTEM READY! üéâ
    </div>

    <!-- Load core dependencies -->
    <script src="utils/wb/wb-component-registry.js"></script>
    <script src="utils/wb/wb-component-utils.js"></script>

    <script type="module">
        class FinalEcosystemTest {
            constructor() {
                this.testResults = {};
                this.testConsole = document.getElementById('test-console');
                this.overallStatus = document.getElementById('overall-status');
                this.startTime = Date.now();
                this.testsCompleted = 0;
                this.totalTests = 4;
            }

            log(message, type = 'INFO') {
                const timestamp = new Date().toISOString().substring(11, 23);
                const logLine = `[${timestamp}] ${type}: ${message}`;
                console.log(logLine);
                this.testConsole.innerHTML += logLine + '\n';
                this.testConsole.scrollTop = this.testConsole.scrollHeight;
            }

            updateStatus(message) {
                this.overallStatus.innerHTML = `üîÑ ${message}`;
            }

            setTestResult(testId, status, message) {
                this.testResults[testId] = { status, message, timestamp: Date.now() };
                const testElement = document.getElementById(testId);
                if (testElement) {
                    const resultElement = testElement.querySelector('.test-result');
                    resultElement.className = `test-result ${status}`;
                    resultElement.textContent = status.toUpperCase();
                    
                    const messageElement = testElement.querySelector('p');
                    messageElement.textContent = message;
                }
                
                this.testsCompleted++;
                this.checkAllTestsComplete();
            }

            checkAllTestsComplete() {
                if (this.testsCompleted >= this.totalTests) {
                    const duration = Date.now() - this.startTime;
                    const passedTests = Object.values(this.testResults).filter(r => r.status === 'pass').length;
                    const failedTests = Object.values(this.testResults).filter(r => r.status === 'fail').length;
                    
                    this.generateFinalReport(passedTests, failedTests, duration);
                    
                    if (failedTests === 0) {
                        this.showSuccess();
                    }
                }
            }

            async runAllTests() {
                this.log('Starting Final WB Component Ecosystem Integration Test');
                this.updateStatus('Running comprehensive integration tests...');

                // Test 1: WBComponentRegistry
                await this.testRegistry();
                
                // Test 2: Control Panel
                await this.testControlPanel();
                
                // Test 3: wb-nav Component
                await this.testWBNav();
                
                // Test 4: Color Components
                await this.testColorComponents();
            }

            async testRegistry() {
                try {
                    this.log('Testing WBComponentRegistry...');
                    
                    if (!window.WBComponentRegistry) {
                        throw new Error('WBComponentRegistry not available');
                    }
                    
                    const requiredMethods = ['register', 'get', 'loadComponent', 'generateHealthReport', 'getDependencies'];
                    const missingMethods = requiredMethods.filter(method => 
                        typeof window.WBComponentRegistry[method] !== 'function'
                    );
                    
                    if (missingMethods.length > 0) {
                        throw new Error(`Missing methods: ${missingMethods.join(', ')}`);
                    }
                    
                    // Test health report
                    const healthReport = window.WBComponentRegistry.generateHealthReport();
                    if (!healthReport || !healthReport.stats) {
                        throw new Error('Health report generation failed');
                    }
                    
                    this.setTestResult('registry-test', 'pass', 
                        `Registry operational with ${healthReport.stats.totalComponents} components`);
                    this.log('WBComponentRegistry: PASS');
                    
                } catch (error) {
                    this.setTestResult('registry-test', 'fail', `Error: ${error.message}`);
                    this.log(`WBComponentRegistry test failed: ${error.message}`, 'ERROR');
                }
            }

            async testControlPanel() {
                try {
                    this.log('Testing Control Panel integration...');
                    
                    // Load control panel component
                    await import('./components/wb-control-panel/wb-control-panel.js');
                    
                    // Wait for registration
                    await this.waitForCustomElement('control-panel', 3000);
                    
                    const controlPanel = document.getElementById('test-control-panel');
                    if (!controlPanel) {
                        throw new Error('Control panel element not found');
                    }
                    
                    // Test critical methods
                    const criticalMethods = ['loadComponents', 'findNavigationElement'];
                    const availableMethods = criticalMethods.filter(method => 
                        typeof controlPanel[method] === 'function'
                    );
                    
                    this.setTestResult('control-panel-test', 'pass', 
                        `Control panel loaded with ${availableMethods.length}/${criticalMethods.length} methods`);
                    this.log('Control Panel: PASS');
                    
                } catch (error) {
                    this.setTestResult('control-panel-test', 'fail', `Error: ${error.message}`);
                    this.log(`Control Panel test failed: ${error.message}`, 'ERROR');
                }
            }

            async testWBNav() {
                try {
                    this.log('Testing wb-nav component...');
                    
                    // Load wb-nav component
                    await import('./components/wb-nav/wb-nav.js');
                    
                    // Wait for registration
                    await this.waitForCustomElement('wb-nav', 3000);
                    
                    // Test the demo nav element
                    const demoNav = document.getElementById('demo-nav-horizontal');
                    if (!demoNav) {
                        throw new Error('Demo nav element not found');
                    }
                    
                    // Wait for nav to initialize
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // Check if nav rendered properly
                    const hasContainer = demoNav.querySelector('.wb-nav-container') !== null;
                    const hasNavList = demoNav.querySelector('.wb-nav-list') !== null;
                    const navLinks = demoNav.querySelectorAll('.wb-nav-link');
                    
                    if (hasContainer && hasNavList && navLinks.length > 0) {
                        this.setTestResult('nav-test', 'pass', 
                            `wb-nav rendered with ${navLinks.length} navigation items`);
                        this.log('wb-nav Component: PASS');
                    } else {
                        throw new Error(`Nav structure incomplete: container(${hasContainer}), list(${hasNavList}), links(${navLinks.length})`);
                    }
                    
                } catch (error) {
                    this.setTestResult('nav-test', 'fail', `Error: ${error.message}`);
                    this.log(`wb-nav test failed: ${error.message}`, 'ERROR');
                }
            }

            async testColorComponents() {
                try {
                    this.log('Testing color components...');
                    
                    // Load color components
                    await import('./components/wb-color-bar/wb-color-bar.js');
                    await import('./components/wb-color-bars/wb-color-bars.js');
                    
                    // Wait for registration
                    await this.waitForCustomElement('wb-color-bar', 3000);
                    await this.waitForCustomElement('wb-color-bars', 3000);
                    
                    // Test the demo color bars element
                    const demoColorBars = document.getElementById('demo-color-bars');
                    if (!demoColorBars) {
                        throw new Error('Demo color bars element not found');
                    }
                    
                    // Wait for color bars to initialize
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    // Check if color bars created wb-color-bar elements
                    const colorBarElements = demoColorBars.querySelectorAll('wb-color-bar');
                    const expectedBars = 6; // 3 for text + 3 for background
                    
                    if (colorBarElements.length >= expectedBars) {
                        this.setTestResult('color-test', 'pass', 
                            `Color system operational with ${colorBarElements.length} color bars`);
                        this.log('Color Components: PASS');
                    } else {
                        throw new Error(`Insufficient color bars: ${colorBarElements.length}/${expectedBars}`);
                    }
                    
                } catch (error) {
                    this.setTestResult('color-test', 'fail', `Error: ${error.message}`);
                    this.log(`Color components test failed: ${error.message}`, 'ERROR');
                }
            }

            async waitForCustomElement(tagName, timeout = 5000) {
                const startTime = Date.now();
                while (Date.now() - startTime < timeout) {
                    if (customElements.get(tagName)) {
                        return true;
                    }
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                throw new Error(`Custom element ${tagName} not registered within ${timeout}ms`);
            }

            generateFinalReport(passed, failed, duration) {
                const summaryResults = document.getElementById('summary-results');
                const totalTests = passed + failed;
                const successRate = Math.round((passed / totalTests) * 100);
                
                let statusColor = '#00ff41';
                let statusText = 'ALL TESTS PASSED';
                
                if (failed > 0) {
                    statusColor = '#ff4757';
                    statusText = `${failed} TEST(S) FAILED`;
                }
                
                summaryResults.innerHTML = `
                    <div style="background: ${statusColor}20; border: 2px solid ${statusColor}; border-radius: 8px; padding: 20px; margin: 20px 0;">
                        <h3 style="color: ${statusColor}; margin: 0 0 15px 0;">${statusText}</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div><strong>Tests Run:</strong> ${totalTests}</div>
                            <div><strong>Passed:</strong> ${passed}</div>
                            <div><strong>Failed:</strong> ${failed}</div>
                            <div><strong>Success Rate:</strong> ${successRate}%</div>
                            <div><strong>Duration:</strong> ${duration}ms</div>
                        </div>
                        
                        <h4 style="margin: 20px 0 10px 0;">Component Status:</h4>
                        <ul style="margin: 0; columns: 2;">
                            ${Object.entries(this.testResults).map(([test, result]) => 
                                `<li style="color: ${result.status === 'pass' ? '#00ff41' : '#ff4757'};">
                                    ${test.replace('-test', '').replace('-', ' ').toUpperCase()}: ${result.status.toUpperCase()}
                                </li>`
                            ).join('')}
                        </ul>
                    </div>
                `;
                
                this.updateStatus(`Testing complete: ${passed}/${totalTests} passed in ${duration}ms`);
                this.log(`Final Results: ${statusText} (${passed}/${totalTests}, ${duration}ms)`);
            }

            showSuccess() {
                document.body.classList.add('ecosystem-ready');
                const successBanner = document.getElementById('success-banner');
                successBanner.style.display = 'block';
                
                // Auto-hide success banner after 3 seconds
                setTimeout(() => {
                    successBanner.style.display = 'none';
                }, 3000);
                
                this.log('üéâ WB COMPONENT ECOSYSTEM FULLY OPERATIONAL!', 'SUCCESS');
            }
        }

        // Initialize and run the final test
        const finalTest = new FinalEcosystemTest();
        
        // Start tests after a short delay
        setTimeout(() => {
            finalTest.runAllTests();
        }, 1000);

        // Expose for debugging
        window.finalTest = finalTest;
        window.debugInfo = () => {
            console.log('='.repeat(50));
            console.log('WB Component Ecosystem Debug Info');
            console.log('='.repeat(50));
            console.log('Test Results:', finalTest.testResults);
            if (window.WBComponentRegistry) {
                console.log('Registry Health:', window.WBComponentRegistry.generateHealthReport());
            }
            console.log('Custom Elements:', {
                'control-panel': !!customElements.get('control-panel'),
                'wb-nav': !!customElements.get('wb-nav'),
                'wb-color-bar': !!customElements.get('wb-color-bar'),
                'wb-color-bars': !!customElements.get('wb-color-bars')
            });
        };
    </script>
</body>
</html>